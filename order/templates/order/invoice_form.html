{% extends 'base.html' %}
{% load staticfiles %}
{% load formsettags %}
{% load widget_tweaks %}

{% block styles %}
    <link href="{% static "css/invoice.css" %}" rel="stylesheet">
{% endblock %}


{% block scripts %}
<script type="text/javascript" src="{% static "jquery.formset.js" %}"></script>
<script type="text/javascript">
    $(function() {
        $('.InvoiceItemInline').formset({
            prefix : '{{ InvoiceItemInline.prefix }}',
            addText: '<span class="btn"><i class="icon-plus-sign"></i> Add another</span>',
            deleteText: '<span class="btn"><i class="icon-remove"></i> Remove</span>',
        });
    });
    
    $('#id_date, #id_date_paid').datepicker({dateFormat: 'dd/mm/yy'});
</script>
<script type="text/javascript" src="{% static "js/invoice.js" %}"></script>
{% endblock %}

{% block content %}
<form method='post' action='{{request.path}}' id="invoice_form">
    {% csrf_token %}
    <fieldset>
        <legend>
            Invoice
        </legend>

        {{form.errors}}

        <table border="0" cellspacing="5" cellpadding="5">
            <tr>
                <td>Code</td><td><span id="code" class="uneditable-input">{{object.code|default:''}}</span></td>
                <td>{{form.date.label}}</td><td>{{form.date}}</td>
            </tr>
            <tr>
                <td>{{form.client.label}}</td><td>{{form.client}}</td>
                <td>{{form.date_paid.label}}</td><td>{{form.date_paid}}</td>
            </tr>
            <tr>
                <td>Net</td><td class="total"><span id="base" class="uneditable-input">{{object.base|default:''}}</span></td>
                <td>Taxes</td><td class="total"><span id="taxes" class="uneditable-input">{{object.taxes|default:''}}</span></td>
                <td>Total</td><td class="total"><span id="total" class="uneditable-input">{{object.total|default:''}}</span></td>
            </tr>
        </table>
        
        <fieldset class="module aligned ">
        <legend>
            Items
        </legend>

        <table class="table">
             <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Tax Name</th>
                <th>Tax Rate</th>
                <th>Net</th>
                <th>Taxes</th>
                <th>Total</th>
                <th>Remove</th>
             </tr>
             {{ InvoiceItemInline.management_form }}
             {% for f in InvoiceItemInline %}
                  <tr class="InvoiceItemInline" id="id_{{ InvoiceItemInline.prefix }}-{{forloop.counter0}}">
                      <td>{{f.id}}
                          {{f.product.errors.as_ul}}{{f.product}}</td>
                      <td>{{f.price.errors.as_ul}}{{f.price|add_class:"input-small"}}</td>
                      <td>{{f.quantity.errors.as_ul}}{{f.quantity|add_class:"input-small"}}</td>
                      <td class="field-tax_name">
                          <span>{{f.instance.tax_name|default_if_none:''}}</span>
                      </td>
                      <td class="numberfield field-tax_rate">
                          <span>{{f.instance.tax_rate|default_if_none:''}}</span>
                      </td>
                      <td class="numberfield field-base"><span>{{f.instance.base|default_if_none:''}}</span></td>
                      <td class="numberfield field-taxes"><span>{{f.instance.taxes|default_if_none:''}}</span></td>
                      <td class="numberfield field-total"><span>{{f.instance.total|default_if_none:''}}</span></td>
                      <td>{{f.DELETE}}</td>
                  </tr>
             {% endfor %}
        </table>
        </fieldset>

    </fieldset>
    <input title='Save this form' type='submit' name='submit' value='Save' />
</form>
{% endblock %}

